<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>張旭</title>
    <description>Web Developer, Script Coder, Daylight Dreamer</description>
    <link>http://zx1986.github.io/</link>
    <atom:link href="http://zx1986.github.io/feed.xml" rel="self" type="application/rss+xml"/>
    <pubDate>Sun, 12 Apr 2015 23:06:10 +0800</pubDate>
    <lastBuildDate>Sun, 12 Apr 2015 23:06:10 +0800</lastBuildDate>
    <generator>Jekyll v2.5.3</generator>
    
      <item>
        <title>Welcome to Jekyll!</title>
        <description>&lt;p&gt;You’ll find this post in your &lt;code&gt;_posts&lt;/code&gt; directory. Go ahead and edit it and re-build the site to see your changes. You can rebuild the site in many different ways, but the most common way is to run &lt;code&gt;jekyll serve&lt;/code&gt;, which launches a web server and auto-regenerates your site when a file is updated.&lt;/p&gt;

&lt;p&gt;To add new posts, simply add a file in the &lt;code&gt;_posts&lt;/code&gt; directory that follows the convention &lt;code&gt;YYYY-MM-DD-name-of-post.ext&lt;/code&gt; and includes the necessary front matter. Take a look at the source for this post to get an idea about how it works.&lt;/p&gt;

&lt;p&gt;Jekyll also offers powerful support for code snippets:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;print_hi&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;Hi, &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;print_hi&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;Tom&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;#=&amp;gt; prints &amp;#39;Hi, Tom&amp;#39; to STDOUT.&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Check out the &lt;a href=&quot;http://jekyllrb.com&quot;&gt;Jekyll docs&lt;/a&gt; for more info on how to get the most out of Jekyll. File all bugs/feature requests at &lt;a href=&quot;https://github.com/jekyll/jekyll&quot;&gt;Jekyll’s GitHub repo&lt;/a&gt;. If you have questions, you can ask them on &lt;a href=&quot;https://github.com/jekyll/jekyll-help&quot;&gt;Jekyll’s dedicated Help repository&lt;/a&gt;.&lt;/p&gt;

</description>
        <pubDate>Sun, 12 Apr 2015 00:35:50 +0800</pubDate>
        <link>http://zx1986.github.io/blog/welcome-to-jekyll.html</link>
        <guid isPermaLink="true">http://zx1986.github.io/blog/welcome-to-jekyll.html</guid>
        
        
        <category>jekyll</category>
        
        <category>update</category>
        
      </item>
    
      <item>
        <title>安裝 Gitlab</title>
        <description>&lt;p&gt;&lt;a href=&quot;http://gitlab.org&quot;&gt;Gitlab&lt;/a&gt; 是一套 Open Source 的 Git 專案管理系統。&lt;br /&gt;
可以把它想象成是 Open Source 的 &lt;a href=&quot;http://github.com&quot;&gt;Github&lt;/a&gt; 網站。&lt;/p&gt;

&lt;p&gt;Gitlab 是使用 Rails 搭配 Gitlab Shell 來實現 Git 專案管理，&lt;br /&gt;
其中 Rails 框架負責網頁與專案管理（account、project、issue、wiki 等）相關的東西，&lt;br /&gt;
在背後透過 &lt;a href=&quot;https://github.com/mojombo/grit&quot;&gt;grit&lt;/a&gt;： &lt;br /&gt;
一個 Ruby 語言實作的操作 Git 的函式庫，&lt;br /&gt;
搭配 &lt;a href=&quot;https://github.com/gitlabhq/gitlab-shell&quot;&gt;Gitlab Shell&lt;/a&gt;：&lt;br /&gt;
一個類似 &lt;a href=&quot;https://github.com/sitaramc/gitolite&quot;&gt;Gitolite&lt;/a&gt; 的 Git Repositories 存取控制系統，&lt;br /&gt;
來控制實際在檔案系統（File System）中的 Git Repositories。&lt;br /&gt;
題外話，Gitlab 在 &lt;a href=&quot;http://blog.gitlab.org/gitlab-5-dot-0-has-been-released/&quot;&gt;5.0 以前&lt;/a&gt;，底層的存取控制系統使用的還是 Gitolite。&lt;/p&gt;

&lt;p&gt;把 Gitlab 架設起來之後，等於是有了一臺自己的 Git Projects Hosting Server。&lt;br /&gt;
其它類似 Gitlab 的 Open Source 軟體還有：&lt;br /&gt;
同樣用 Rails 框架開發的 &lt;a href=&quot;http://gitorious.org/&quot;&gt;Gitorious&lt;/a&gt;；&lt;br /&gt;
使用 PHP 的 Pluf 框架開發的 &lt;a href=&quot;http://www.indefero.net/&quot;&gt;Indefero&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;本文記錄 RHEL 6.3 x86_64 環境中安裝 Gitlab 的過程。&lt;br /&gt;
如果是 Ubuntu 的環境要安裝 Gitlab 會更簡單，請直接參考&lt;a href=&quot;https://github.com/gitlabhq/gitlabhq#installation&quot;&gt;官方的安裝手冊&lt;/a&gt;。&lt;/p&gt;

&lt;h2 id=&quot;section&quot;&gt;安裝相依性套件&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;cd /opt&lt;/li&gt;
  &lt;li&gt;wget http://mirror01.idc.hinet.net/EPEL/6/i386/epel-release-6-8.noarch.rpm&lt;/li&gt;
  &lt;li&gt;rpm -iUvh epel-release-6-8.noarch.rpm&lt;/li&gt;
  &lt;li&gt;yum clean all&lt;/li&gt;
  &lt;li&gt;yum list&lt;/li&gt;
  &lt;li&gt;yum remove gitosis&lt;/li&gt;
  &lt;li&gt;yum groupinstall “Development Tools”&lt;/li&gt;
  &lt;li&gt;yum update &amp;amp;&amp;amp; yum upgrade&lt;/li&gt;
  &lt;li&gt;yum install vim python wget curl git openssh-server&lt;/li&gt;
  &lt;li&gt;yum install sqlite sqlite-devel mysql mysql-libs mysql-devel&lt;/li&gt;
  &lt;li&gt;yum install ncurses-devel libcurl-devel libcurl curl patch sudo&lt;/li&gt;
  &lt;li&gt;yum install libxslt-devel libyaml-devel libxml2 libxml2-devel gdbm-devel libffi libffi-devel zlib zlib-devel openssl-devel readline readline-devel curl-devel openssl-devel pcre-devel memcached-devel valgrind-devel ImageMagick-devel ImageMagick libicu libicu-devel make bzip2 autoconf automake libtool bison redis&lt;/li&gt;
  &lt;li&gt;chkconfig redis on&lt;/li&gt;
  &lt;li&gt;service redis start&lt;/li&gt;
  &lt;li&gt;yum install postfix&lt;/li&gt;
  &lt;li&gt;chkconfig postfix on&lt;/li&gt;
  &lt;li&gt;service postfix start&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;如果EPEL 套件庫少東西，請到 http://pkgs.org/ 把套件手動補齊。&lt;br /&gt;
比較常有問題的是以下這幾個套件：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;gdbm-devel&lt;/li&gt;
  &lt;li&gt;libffi-devel&lt;/li&gt;
  &lt;li&gt;libicu-devel&lt;/li&gt;
  &lt;li&gt;iconv-devel&lt;/li&gt;
  &lt;li&gt;valgrind-devel&lt;/li&gt;
  &lt;li&gt;ImageMagick-devel&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;gitlab-&quot;&gt;設定 Gitlab 系統帳號&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;useradd git&lt;/li&gt;
  &lt;li&gt;passwd git&lt;/li&gt;
  &lt;li&gt;chmod 755 /home/git&lt;/li&gt;
  &lt;li&gt;su - git&lt;/li&gt;
  &lt;li&gt;mkdir -p /home/git/.ssh&lt;/li&gt;
  &lt;li&gt;chmod -R 700 /home/git/.ssh&lt;/li&gt;
  &lt;li&gt;touch /home/git/.ssh/authorized_keys&lt;/li&gt;
  &lt;li&gt;chmod -R 600 /home/git/.ssh/authorized_keys&lt;/li&gt;
  &lt;li&gt;ssh-keygen -t rsa&lt;/li&gt;
  &lt;li&gt;cat /home/git/.ssh/id_rsa.pub » /home/git/.ssh/authorized_keys&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;ruby-&quot;&gt;安裝 Ruby 環境&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;su - git&lt;/li&gt;
  &lt;li&gt;mkdir -p /home/git/temp&lt;/li&gt;
  &lt;li&gt;mkdir -p /home/git/ruby&lt;/li&gt;
  &lt;li&gt;cd /home/git/temp&lt;/li&gt;
  &lt;li&gt;wget -c “http://ftp.ruby-lang.org/pub/ruby/1.9/ruby-1.9.3-p392.tar.gz”&lt;/li&gt;
  &lt;li&gt;tar zxvf ruby-1.9.3-p392.tar.gz &amp;amp;&amp;amp; cd ruby-1.9.3-p392&lt;/li&gt;
  &lt;li&gt;./configure --prefix=/home/git/ruby&lt;/li&gt;
  &lt;li&gt;make&lt;/li&gt;
  &lt;li&gt;make install&lt;/li&gt;
  &lt;li&gt;vim ~/.bash_profile   &lt;code&gt;PATH=$HOME/ruby/bin:$PATH:$HOME/bin;&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;vim ~/.bashrc   &lt;code&gt;PATH=$HOME/ruby/bin:$PATH:$HOME/bin;&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;source ~/.bash_profile&lt;/li&gt;
  &lt;li&gt;which ruby&lt;/li&gt;
  &lt;li&gt;ruby --version&lt;/li&gt;
  &lt;li&gt;gem install bundler&lt;/li&gt;
  &lt;li&gt;gem install charlock_holmes --version ‘0.6.9’&lt;/li&gt;
  &lt;li&gt;cd ~&lt;/li&gt;
  &lt;li&gt;rm -rf ~/temp&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;section-1&quot;&gt;設定資料庫&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;yum install mysql-server mysql myslq-devel&lt;/li&gt;
  &lt;li&gt;chkconfig mysqld on&lt;/li&gt;
  &lt;li&gt;service mysqld start&lt;/li&gt;
  &lt;li&gt;mysql -u root -p&lt;/li&gt;
  &lt;li&gt;mysql&amp;gt; CREATE DATABASE IF NOT EXISTS `gitlab` DEFAULT CHARACTER SET `utf8` COLLATE `utf8_unicode_ci`;&lt;/li&gt;
  &lt;li&gt;mysql&amp;gt; CREATE USER ‘gitlab’@’localhost’ IDENTIFIED BY ‘12345678’;&lt;/li&gt;
  &lt;li&gt;mysql&amp;gt; GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, DROP, INDEX, ALTER ON `gitlab`.* TO ‘gitlab’@’localhost’;&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;gitlab-shell&quot;&gt;安裝 Gitlab Shell&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;su - git&lt;/li&gt;
  &lt;li&gt;cd /home/git&lt;/li&gt;
  &lt;li&gt;git clone http://github.com/gitlabhq/gitlab-shell.git&lt;/li&gt;
  &lt;li&gt;cd gitlab-shell&lt;/li&gt;
  &lt;li&gt;cp config.yml.example config.yml&lt;/li&gt;
  &lt;li&gt;vim config.yml&lt;/li&gt;
&lt;/ol&gt;

&lt;pre&gt;&lt;code&gt;# GitLab user. git by default
user: git

# Url to gitlab instance. Used for api calls. Should be ends with slash.
gitlab_url: &quot;http://test-git.mfc.cwb/&quot;

http_settings:
#  user: someone
#  password: somepass
   self_signed_cert: false

# Repositories path
repos_path: &quot;/home/git/repositories&quot;

# File used as authorized_keys for gitlab user
auth_file: &quot;/home/git/.ssh/authorized_keys&quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;ol&gt;
  &lt;li&gt;/home/git/gitlab-shell/bin/install&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;gitlab&quot;&gt;安裝 Gitlab&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;su - git&lt;/li&gt;
  &lt;li&gt;cd /home/git&lt;/li&gt;
  &lt;li&gt;git config --global user.name  “GitLab”&lt;/li&gt;
  &lt;li&gt;git config --global user.email “gitlab@gitlab.YOUR.HOST”&lt;/li&gt;
  &lt;li&gt;mkdir gitlab-satellites&lt;/li&gt;
  &lt;li&gt;git clone http://github.com/gitlabhq/gitlabhq.git gitlab&lt;/li&gt;
  &lt;li&gt;cd gitlab&lt;/li&gt;
  &lt;li&gt;git checkout 5-0-stable&lt;/li&gt;
  &lt;li&gt;more VERSION&lt;/li&gt;
  &lt;li&gt;cp config/gitlab.yml.example config/gitlab.yml&lt;/li&gt;
  &lt;li&gt;vim config/gitlab.yml&lt;/li&gt;
&lt;/ol&gt;

&lt;pre&gt;&lt;code&gt;## GitLab settings
  gitlab:

## Web server settings
  host: test-git.mfc.cwb
  port: 80
  https: false
  user: git

## Gravatar
  gravatar:
  enabled: false
&lt;/code&gt;&lt;/pre&gt;

&lt;ol&gt;
  &lt;li&gt;mkdir tmp/pids/&lt;/li&gt;
  &lt;li&gt;chown -R git log/ tmp/&lt;/li&gt;
  &lt;li&gt;chmod -R u+rwX  log/ tmp/&lt;/li&gt;
  &lt;li&gt;cp config/unicorn.rb.example config/unicorn.rb&lt;/li&gt;
  &lt;li&gt;vim config/unicorn.rb   &lt;code&gt;listen &quot;127.0.0.1:8080&quot;&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;cp config/database.yml.mysql config/database.yml&lt;/li&gt;
  &lt;li&gt;vim config/database.yml&lt;/li&gt;
&lt;/ol&gt;

&lt;pre&gt;&lt;code&gt;production:
  adapter: mysql2
  encoding: utf8
  reconnect: false
  database: gitlab
  pool: 5
  username: gitlab
  password: &quot;12345678&quot;
  host: localhost
&lt;/code&gt;&lt;/pre&gt;

&lt;ol&gt;
  &lt;li&gt;cd /home/git/gitlab&lt;/li&gt;
  &lt;li&gt;&lt;del&gt;編輯 Gemfile 並將所有 git:// 與 https:// 改成 http://&lt;/del&gt;&lt;/li&gt;
  &lt;li&gt;bundle install --no-deployment&lt;/li&gt;
  &lt;li&gt;bundle install --deployment --without development test postgres&lt;/li&gt;
  &lt;li&gt;bundle exec rake gitlab:setup RAILS_ENV=production&lt;/li&gt;
  &lt;li&gt;&lt;del&gt;bundle exec rake db:seed_fu RAILS_ENV=production&lt;/del&gt;&lt;/li&gt;
  &lt;li&gt;bundle exec rake gitlab:env:info RAILS_ENV=production&lt;/li&gt;
  &lt;li&gt;bundle exec rake gitlab:check RAILS_ENV=production&lt;/li&gt;
&lt;/ol&gt;

&lt;ul&gt;
  &lt;li&gt;碰到 invalid gem format for /path/to/cache/xxx.gem 問題，&lt;br /&gt;
刪掉該 cache 的 gem，再重跑 bundle install 即可&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;gitlab--1&quot;&gt;設定 Gitlab 啓動腳本&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;su - root&lt;/li&gt;
  &lt;li&gt;curl --output /etc/init.d/gitlab https://raw.github.com/gitlabhq/gitlab-recipes/master/init.d/gitlab&lt;/li&gt;
  &lt;li&gt;chkconfig --add gitlab&lt;/li&gt;
  &lt;li&gt;chkconfig gitlab on&lt;/li&gt;
  &lt;li&gt;chmod +x /etc/init.d/gitlab&lt;/li&gt;
  &lt;li&gt;/etc/init.d/gitlab start&lt;/li&gt;
  &lt;li&gt;/etc/init.d/gitlab status&lt;/li&gt;
  &lt;li&gt;Unicorn 與 Sidekiq 服務跑起來需要點時間，要等一下&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;apache&quot;&gt;設定 Apache&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;su - root&lt;/li&gt;
  &lt;li&gt;yum install httpd&lt;/li&gt;
  &lt;li&gt;vim /etc/httpd/conf/httpd.conf&lt;/li&gt;
&lt;/ol&gt;

&lt;pre&gt;&lt;code&gt;NameVirtualHost *:80

&amp;lt;VirtualHost *:80&amp;gt;
    ServerName gitlab.YOUR.HOST
    DocumentRoot /home/git/gitlab/public
    CustomLog logs/gitlab-access.log combined
    ErrorLog logs/gitlab-error.log

    ProxyPass /  http://127.0.0.1:8080/
    ProxyPassReverse /  http://127.0.0.1:8080/
    ProxyPreserveHost On
&amp;lt;/VirtualHost&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;ol&gt;
  &lt;li&gt;chmod 755 /home/git&lt;/li&gt;
  &lt;li&gt;chkconfig httpd on&lt;/li&gt;
  &lt;li&gt;service httpd restart&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Gitlab 預設帳號：admin@local.host   &lt;br /&gt;
Gitlab 預設密碼：5iveL!fe&lt;/p&gt;

</description>
        <pubDate>Sat, 01 Jun 2013 23:04:05 +0800</pubDate>
        <link>http://zx1986.github.io/blog/gitlab.html</link>
        <guid isPermaLink="true">http://zx1986.github.io/blog/gitlab.html</guid>
        
        
        <category>git</category>
        
        <category>linux</category>
        
      </item>
    
      <item>
        <title>安裝 Gitlab CI</title>
        <description>&lt;h2 id=&quot;continous-integration&quot;&gt;關於 Continous Integration&lt;/h2&gt;

&lt;p&gt;……&lt;/p&gt;

&lt;p&gt;在 RHEL（Red Hat/CentOS/Fedora）環境安裝 Gitlab CI；   &lt;br /&gt;
以下安裝過程爲 RHEL 6.3 x86_64 中的執行記錄。&lt;/p&gt;

&lt;h2 id=&quot;install-required-packages&quot;&gt;Install Required Packages&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;cd /opt&lt;/li&gt;
  &lt;li&gt;wget http://mirror01.idc.hinet.net/EPEL/6/i386/epel-release-6-8.noarch.rpm&lt;/li&gt;
  &lt;li&gt;rpm -iUvh epel-release-6-8.noarch.rpm&lt;/li&gt;
  &lt;li&gt;yum clean all&lt;/li&gt;
  &lt;li&gt;yum groupinstall “Development Tools”&lt;/li&gt;
  &lt;li&gt;yum update &amp;amp;&amp;amp; yum upgrade&lt;/li&gt;
  &lt;li&gt;yum install vim python wget curl git openssh-server&lt;/li&gt;
  &lt;li&gt;yum install sqlite sqlite-devel mysql mysql-libs mysql-devel&lt;/li&gt;
  &lt;li&gt;yum install ncurses-devel libcurl-devel libcurl curl patch sudo&lt;/li&gt;
  &lt;li&gt;yum install libxslt-devel libyaml-devel libxml2 libxml2-devel gdbm-devel libffi libffi-devel zlib zlib-devel openssl-devel readline readline-devel curl-devel openssl-devel pcre-devel memcached-devel valgrind-devel ImageMagick-devel ImageMagick libicu libicu-devel make bzip2 autoconf automake libtool bison redis libpq-devel libicu-devel postgresql-libs postgresql-devel&lt;/li&gt;
  &lt;li&gt;chkconfig redis on&lt;/li&gt;
  &lt;li&gt;service redis start&lt;/li&gt;
  &lt;li&gt;yum install postfix&lt;/li&gt;
  &lt;li&gt;chkconfig postfix on&lt;/li&gt;
  &lt;li&gt;service postfix start&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;setup-database-mysql&quot;&gt;Setup Database (MySQL)&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;su - root&lt;/li&gt;
  &lt;li&gt;yum install mysql mysql-devel&lt;/li&gt;
  &lt;li&gt;chkconfig mysqld on&lt;/li&gt;
  &lt;li&gt;service mysqld start&lt;/li&gt;
  &lt;li&gt;mysql -u root -p&lt;/li&gt;
  &lt;li&gt;mysql&amp;gt; CREATE DATABASE IF NOT EXISTS `gitlab_ci` DEFAULT CHARACTER SET `utf8` COLLATE `utf8_unicode_ci`;&lt;/li&gt;
  &lt;li&gt;mysql&amp;gt; CREATE USER ‘gitlab_ci’@’localhost’ IDENTIFIED BY ‘12345678’;&lt;/li&gt;
  &lt;li&gt;mysql&amp;gt; GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, DROP, INDEX, ALTER ON `gitlab_ci`.* TO ‘gitlab_ci’@’localhost’;&lt;/li&gt;
&lt;/ol&gt;

&lt;ul&gt;
  &lt;li&gt;預設資料庫帳號爲 gitlab_ci&lt;/li&gt;
  &lt;li&gt;預設資料庫密碼爲 12345678&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;setup-account-gitlabci&quot;&gt;Setup Account (gitlab_ci)&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;useradd gitlab_ci&lt;/li&gt;
  &lt;li&gt;passwd gitlab_ci&lt;/li&gt;
  &lt;li&gt;chmod 755 /home/gitlab_ci&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;setup-ruby-using-rvm&quot;&gt;Setup Ruby (using RVM)&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;su - gitlab_ci&lt;/li&gt;
  &lt;li&gt;
    &lt;table&gt;
      &lt;tbody&gt;
        &lt;tr&gt;
          &lt;td&gt;\curl -L https://get.rvm.io&lt;/td&gt;
          &lt;td&gt;bash -s stable --ruby&lt;/td&gt;
        &lt;/tr&gt;
      &lt;/tbody&gt;
    &lt;/table&gt;
  &lt;/li&gt;
  &lt;li&gt;echo “source /home/gitlab_ci/.rvm/scripts/rvm” » ~/.bashrc&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;setup-gitlab-ci&quot;&gt;Setup Gitlab CI&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;su - gitlab_ci&lt;/li&gt;
  &lt;li&gt;cd /home/gitlab_ci/&lt;/li&gt;
  &lt;li&gt;git clone https://github.com/gitlabhq/gitlab-ci.git&lt;/li&gt;
  &lt;li&gt;cd gitlab-ci&lt;/li&gt;
  &lt;li&gt;git checkout 2-2-stable&lt;/li&gt;
  &lt;li&gt;mkdir -p tmp/pids&lt;/li&gt;
  &lt;li&gt;mkdir -p tmp/sockets&lt;/li&gt;
  &lt;li&gt;gem install bundler&lt;/li&gt;
  &lt;li&gt;bundle --without development test&lt;/li&gt;
  &lt;li&gt;cp config/database.yml.mysql config/database.yml&lt;/li&gt;
  &lt;li&gt;vim config/database.yml&lt;/li&gt;
&lt;/ol&gt;

&lt;pre&gt;&lt;code&gt;    production:
      adapter: mysql2
      encoding: utf8
      reconnect: false
      database: gitlab_ci
      pool: 5
      username: gitlab_ci
      password: &quot;12345678&quot;
      host: localhost
      # socket: /tmp/mysql.sock

    ......
&lt;/code&gt;&lt;/pre&gt;

&lt;ol&gt;
  &lt;li&gt;bundle exec rake db:setup RAILS_ENV=production&lt;/li&gt;
  &lt;li&gt;bundle exec whenever -w RAILS_ENV=production&lt;/li&gt;
  &lt;li&gt;crontab -l&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;setup-gitlabci-service-script&quot;&gt;Setup gitlab_ci Service Script&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;su - root&lt;/li&gt;
  &lt;li&gt;wget https://raw.github.com/gitlabhq/gitlab-ci/2-2-stable/lib/support/init.d/gitlab_ci -P /etc/init.d/ --no-check-certificate&lt;/li&gt;
  &lt;li&gt;chmod +x /etc/init.d/gitlab_ci&lt;/li&gt;
  &lt;li&gt;/etc/init.d/gitlab_ci start&lt;/li&gt;
  &lt;li&gt;/etc/init.d/gitlab_ci status&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;setup-nginx&quot;&gt;Setup Nginx&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;yum install nginx&lt;/li&gt;
  &lt;li&gt;wget https://raw.github.com/gitlabhq/gitlab-ci/2-2-stable/lib/support/nginx/gitlab_ci -P /etc/nginx/conf.d/ --no-check-certificate&lt;/li&gt;
  &lt;li&gt;mv /etc/nginx/gitlab_ci /etc/nginx/gitlab_ci.conf&lt;/li&gt;
  &lt;li&gt;vim /etc/nginx/gitlab_ci.conf&lt;/li&gt;
&lt;/ol&gt;

&lt;pre&gt;&lt;code&gt;    ......

    server {
      listen YOUR_SERVER_IP:80;         
      server_name YOUR_SERVER_NAME;          
      root /home/gitlab_ci/gitlab-ci/public;

    ......
&lt;/code&gt;&lt;/pre&gt;

&lt;ol&gt;
  &lt;li&gt;chkconfig nginx on&lt;/li&gt;
  &lt;li&gt;service nginx start&lt;/li&gt;
  &lt;li&gt;netstat -ltn&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Gitlab Default Account: admin@local.host      &lt;br /&gt;
Gitlab Default Password: 5iveL!fe&lt;/p&gt;

</description>
        <pubDate>Sat, 01 Jun 2013 19:17:35 +0800</pubDate>
        <link>http://zx1986.github.io/blog/gitlab-ci.html</link>
        <guid isPermaLink="true">http://zx1986.github.io/blog/gitlab-ci.html</guid>
        
        
        <category>git</category>
        
        <category>linux</category>
        
        <category>test</category>
        
      </item>
    
      <item>
        <title>Meteor</title>
        <description>&lt;p&gt;http://docs.meteor.com&lt;/p&gt;
</description>
        <pubDate>Thu, 30 May 2013 16:44:42 +0800</pubDate>
        <link>http://zx1986.github.io/blog/meteor.html</link>
        <guid isPermaLink="true">http://zx1986.github.io/blog/meteor.html</guid>
        
        
        <category>javascript</category>
        
        <category>framework</category>
        
      </item>
    
      <item>
        <title>tmux</title>
        <description>
</description>
        <pubDate>Wed, 29 May 2013 14:35:17 +0800</pubDate>
        <link>http://zx1986.github.io/blog/tmux.html</link>
        <guid isPermaLink="true">http://zx1986.github.io/blog/tmux.html</guid>
        
        
      </item>
    
      <item>
        <title>Gluster</title>
        <description>&lt;p&gt;http://www.gluster.org&lt;/p&gt;
</description>
        <pubDate>Tue, 28 May 2013 15:27:30 +0800</pubDate>
        <link>http://zx1986.github.io/blog/gluster.html</link>
        <guid isPermaLink="true">http://zx1986.github.io/blog/gluster.html</guid>
        
        
        <category>linux</category>
        
        <category>cluster</category>
        
      </item>
    
      <item>
        <title>Webmin</title>
        <description>&lt;p&gt;http://www.webmin.com/&lt;/p&gt;
</description>
        <pubDate>Tue, 28 May 2013 14:53:26 +0800</pubDate>
        <link>http://zx1986.github.io/blog/webmin.html</link>
        <guid isPermaLink="true">http://zx1986.github.io/blog/webmin.html</guid>
        
        
        <category>system</category>
        
        <category>linux</category>
        
      </item>
    
      <item>
        <title>Zabbix</title>
        <description>&lt;p&gt;http://www.zabbix.com/&lt;/p&gt;
</description>
        <pubDate>Tue, 28 May 2013 14:52:20 +0800</pubDate>
        <link>http://zx1986.github.io/blog/zabbix.html</link>
        <guid isPermaLink="true">http://zx1986.github.io/blog/zabbix.html</guid>
        
        
        <category>network</category>
        
        <category>system</category>
        
        <category>linux</category>
        
      </item>
    
      <item>
        <title>OpenStack</title>
        <description>&lt;p&gt;http://www.openstack.org/&lt;/p&gt;
</description>
        <pubDate>Mon, 27 May 2013 15:33:32 +0800</pubDate>
        <link>http://zx1986.github.io/blog/openstack.html</link>
        <guid isPermaLink="true">http://zx1986.github.io/blog/openstack.html</guid>
        
        
        <category>system</category>
        
        <category>linux</category>
        
        <category>cluster</category>
        
      </item>
    
      <item>
        <title>使用 Puppet</title>
        <description>&lt;p&gt;&lt;a href=&quot;http://puppetlabs.com/&quot;&gt;Puppet&lt;/a&gt; &lt;br /&gt;
是用 Ruby 語言開發的 Client/Server 式的配置、設定、服務管理工具。&lt;/p&gt;

&lt;p&gt;簡單描述一下，&lt;br /&gt;
就是所有機器的配置集中在 Puppet Server 上管理，&lt;br /&gt;
Puppet Client 機器連線到 Puppet Server，&lt;br /&gt;
Puppet Server 根據 Puppet Client 提供的資訊，&lt;br /&gt;
動態產生正確的配置，對 Puppet Client 進行設定。&lt;/p&gt;

&lt;p&gt;Puppet Client 使用的是一個叫 facter 的工具取得主機基本資訊，&lt;br /&gt;
Puppet Server 根據傳來的資訊（例如：IP，hostname，OS）產生對應的配置內容。&lt;/p&gt;

&lt;p&gt;在 Ubuntu 系統上安裝 Puppet 非常簡單：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;sudo apt-get install ruby-full # 安裝 Ruby 環境
sudo apt-get install facter # 安裝 Facter 後可以直接執行 facter 測試一下
sudo apt-get install puppet # Puppet Client 套件 
sudo apt-get install puppetmaster # Puppet Server 套件，Puppet Client 不需安裝

# 在 Redhat 環境，Puppet Client 套件叫：puppet
# 在 Redhat 環境，Puppet Server 套件叫：puppet-server
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Puppet 看待裝置或服務的哲學跟 UNIX 很像：&lt;br /&gt;
每一個裝置、服務對 Puppet 來說，都是一個「資源（Resource）」。&lt;/p&gt;

&lt;h3 id=&quot;pp-&quot;&gt;*.pp 檔&lt;/h3&gt;

&lt;p&gt;Puppet 解讀名爲 *.pp 的檔案，然後對不同的 Client 編譯產生不同的配置。&lt;/p&gt;

&lt;p&gt;一個簡單的 test.pp 檔案內容如下：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;file
{
    &quot;/tmp/test.txt&quot;: content =&amp;gt; &quot;hello, world&quot;;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;執行：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;puppet test.pp
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;執行結果是在 /tmp 底下產生一個 test.txt 檔，且內容爲「hello, world」。&lt;/p&gt;

&lt;p&gt;*.pp 有一套簡單的文法與規則，其中亦有類別跟繼承等，強烈建議閱讀文件！&lt;/p&gt;

&lt;h3 id=&quot;puppet-clientserver-&quot;&gt;Puppet Client/Server 運作流程&lt;/h3&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;Puppet Client 的 puppetd 程式呼叫 facter 程式，&lt;br /&gt;
facter 程式會偵測出 Puppet Client 主機的相關資訊，&lt;br /&gt;
例如 hostname、RAM、Hard Disk、IP 等等。&lt;br /&gt;
Puppet Client 的 puppetd 再透過 SSL 把這些訊息傳到 Puppet Server。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Puppet Server 的 puppetmaster 程式檢查 Puppet Client 送來的資訊，&lt;br /&gt;
會使用 Puppet Client 的 hostname 來找到 /etc/puppet/manifest 裡面對應的 node 配置，&lt;br /&gt;
然後分析以及解讀牽涉到的 *.pp 檔或 Puppet 程式碼，&lt;br /&gt;
Puppet Client 使用 facter 生成的訊息會被當成變數傳入這些 *.pp 檔或 Puppet 程式碼。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;當 Puppet Server 知道需要處理哪些 *.pp 檔後，就會將它們進行解析，&lt;br /&gt;
這個 *.pp 檔解析的動作可以看成是程式的編譯（直譯？）。&lt;br /&gt;
解析會分成幾個階段，首先是語法檢查，語法錯誤就會直接報錯了；&lt;br /&gt;
語法檢查通過，會產生解析的結果，&lt;br /&gt;
這個結果同樣會透過 SSL 傳送回 Puppet Client。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Puppet Client 收到 Puppet Server 的解析結果，執行，並把執行的結果回傳。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Puppet Server 把 Puppet Client 的執行結果寫到 log。&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;puppet-clientserver--1&quot;&gt;Puppet Client/Server 配置&lt;/h3&gt;

&lt;p&gt;Puppet Client 與 Puppet Server 的安裝、設定、配置，最好都使用 root 帳號。&lt;/p&gt;

&lt;p&gt;進行 Client/Server 設置前，請務必千萬確定每臺主機的 hostname！&lt;br /&gt;
Puppet 的 Client/Server 配置有綁定 hostname 進行驗證，&lt;br /&gt;
且要求符合 FQDN 的 hostname。&lt;br /&gt;
請先執行 hostname 並檢查 /etc/hostname 進行確定，&lt;br /&gt;
並確認 /etc/hosts 檔案有正確的 hostname 與 IP 配對。&lt;/p&gt;

&lt;p&gt;連線與驗證都需要 root 身份來進行。&lt;br /&gt;
Puppet Client 與 Server 的系統時間要校正一致，否則認證會出問題！&lt;br /&gt;
務必使用同樣的 NTP Server 進行時間同步！&lt;/p&gt;

&lt;p&gt;在 Client/Server 環境中，&lt;br /&gt;
Puppet Server 預設讀取 *.pp 的路徑是：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;/etc/puppet/manifests/
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;可以編寫一個 /etc/puppet/manifests/site.pp 檔測試：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;node default
{
    file
    {
        &quot;/tmp/puppet_server.message&quot;:
        content =&amp;gt; &quot;Hello, Puppet Client!&quot;;
    }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;第一次進行 Client/Server 的配置連線會需要驗證。&lt;/p&gt;

&lt;p&gt;先在 Puppet Client 執行：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;puppetd --server 伺服器主機名稱 --test
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;再到 Puppet Server 執行：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;puppetca --sign 客戶端主機名稱
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;最後回到 Puppet Client 執行：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;puppetd --server 伺服器主機名稱 --test
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;此時，Puppet Client 應該會得到一個 /tmp/puppet_server.message 檔。&lt;/p&gt;

&lt;h3 id=&quot;puppet-ca-&quot;&gt;Puppet CA 驗證&lt;/h3&gt;

&lt;p&gt;Puppet 的驗證文件預設在：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;/var/lib/puppet/ssl # Puppet Client
/var/lib/puppet/ssl/ca/ # Puppet Server
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;若某個 Puppet Client 的驗證有問題，&lt;br /&gt;
可以在 Puppet Server 使用 &lt;code&gt;puppetca --clean 主機名稱&lt;/code&gt; 刪除認證，&lt;br /&gt;
相關指令可以參考：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;puppetca --list --all # 列出目前 Server 所有的 Client
puppetca --list
puppetca --sign CLIENT_HOSTNAME
puppetca --print CLIENT_HOSTNAME
puppetca --clean CLIENT_HOSTNAME  # 刪除舊的認證

man puppetca
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;如果還是不行，直接到 Puppet Server 的 &lt;code&gt;/var/lib/puppet/ssl/ca/&lt;/code&gt; 資料夾，&lt;br /&gt;
找到相對應的 *.pem，刪除，再重新認證 Puppet client。&lt;/p&gt;

&lt;h3 id=&quot;etcpuppet-1&quot;&gt;&lt;a href=&quot;http://projects.puppetlabs.com/projects/puppet/wiki/Puppet_Best_Practice2&quot;&gt;建議的 /etc/puppet/ 目錄架構&lt;/a&gt;&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;manifests/
        site.pp
        templates.pp
        nodes.pp

modules/
        {module_name}

modules/user/

services/

clients/

notes/

plugins/

tools/
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;puppet-module2&quot;&gt;&lt;a href=&quot;http://docs.puppetlabs.com/guides/modules.html&quot;&gt;使用 Puppet Module&lt;/a&gt;&lt;/h3&gt;

&lt;h3 id=&quot;puppet-template3&quot;&gt;&lt;a href=&quot;http://docs.puppetlabs.com/learning/templates.html&quot;&gt;使用 Puppet Template&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;Puppet Template 可以用來動態產生不同的內容。&lt;br /&gt;
應用的情境比較像是同樣的設定檔，但是有些許的設定不盡相同。&lt;br /&gt;
例如都是 httpd 服務，不見得所有 Puppet node 的 httpd.conf 都完全相同。&lt;/p&gt;

&lt;p&gt;Puppet Template 檔是使用 Ruby 的 &lt;a href=&quot;http://www.ruby-doc.org/stdlib/libdoc/erb/rdoc/classes/ERB.html&quot;&gt;ERB Template&lt;/a&gt;，並不難寫。 &lt;br /&gt;
Template 的使用也很簡單：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$value = template(&quot;my_template.erb&quot;)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;my_template.erb 可換成 erb 檔的絕對路徑，&lt;br /&gt;
或把 erb 檔放到 Puppet 預設會找的路徑。&lt;br /&gt;
Red Hat 環境預設是 &lt;code&gt;/var/lib/puppet/templates&lt;/code&gt;；&lt;br /&gt;
Ubuntu 環境預設是 &lt;code&gt;/etc/puppet/templates&lt;/code&gt;。&lt;/p&gt;

&lt;p&gt;可以使用 &lt;code&gt;puppet --configprint templatedir&lt;/code&gt; 指令確認路徑，&lt;br /&gt;
實作的建議是把 erb 檔放到各個 Module 資料夾中。&lt;/p&gt;

&lt;p&gt;題外話，可以執行 &lt;code&gt;puppet --configprint all&lt;/code&gt; 看看 :-)&lt;/p&gt;

&lt;h3 id=&quot;puppet-&quot;&gt;Puppet 設定檔範例&lt;/h3&gt;

&lt;p&gt;https://github.com/example42/puppet-modules&lt;br /&gt;
https://github.com/ghoneycutt/puppet-generic   &lt;br /&gt;
https://github.com/jenkinsci/puppet-jenkins   &lt;br /&gt;
https://github.com/jfryman/puppet-nginx&lt;/p&gt;

&lt;h3 id=&quot;puppet-4&quot;&gt;&lt;a href=&quot;http://docs.puppetlabs.com/references/glossary.html&quot;&gt;Puppet 名詞解釋&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;catalog : A catalog is the totality of resources, files, properties, etc, for a given system.&lt;/p&gt;

&lt;p&gt;manifest : A configuration file written in the Puppet language. These files should have the .pp extension.&lt;/p&gt;

&lt;p&gt;module : A collection of classes, resource types, files, and templates, organized around a particular purpose.&lt;/p&gt;

&lt;p&gt;node (general noun) : An individual server; for the purposes of discussing Puppet, this generally refers to an agent node.&lt;/p&gt;

&lt;p&gt;node (Puppet language keyword) : A collection of classes and/or resources to be applied to the agent node whose unique identifier (“certname”) matches the specified node name. Nodes defined in manifests allow inheritance, although this should be used with care due to the behavior of dynamic variable scoping.&lt;/p&gt;

&lt;p&gt;provider : A simple implementation of a type; examples of package providers are dpkg and rpm, and examples of user providers are useradd and netinfo. Most often, providers are just Ruby wrappers around shell commands, and they are usually very short and thus easy to create.&lt;/p&gt;

&lt;p&gt;templates : templates are ERB files used to generate configuration files for systems and are used in cases where the configuration file is not static but only requires minor changes based on variables that Puppet can provide (such as hostname). See also distributable file.&lt;/p&gt;

&lt;p&gt;type : abstract description of a type of resource. Can be implemented as a native type, plug-in type, or defined type.&lt;/p&gt;

&lt;p&gt;agent or agent node : An operating system instance managed by Puppet. This can be an operating system running on its own hardware or a virtual image.&lt;/p&gt;

&lt;p&gt;推薦文件：   &lt;br /&gt;
http://puppet.wikidot.com&lt;/p&gt;

&lt;p&gt;Reference：   &lt;br /&gt;
http://puppet-manifest-share.googlecode.com/files/puppet-1.0.pdf    &lt;br /&gt;
http://www.comeonsa.com/category/puppet/    &lt;br /&gt;
http://bitcube.co.uk/content/puppet-errors-explained    &lt;br /&gt;
http://www.example42.com    &lt;br /&gt;
http://docs.puppetlabs.com/guides/troubleshooting.html    &lt;br /&gt;
http://docs.puppetlabs.com/guides/troubleshooting.html    &lt;br /&gt;
http://blog.akquinet.de/2011/11/23/managing-an-apache-server-with-puppet/&lt;/p&gt;

</description>
        <pubDate>Sun, 26 May 2013 21:43:54 +0800</pubDate>
        <link>http://zx1986.github.io/blog/puppet.html</link>
        <guid isPermaLink="true">http://zx1986.github.io/blog/puppet.html</guid>
        
        
        <category>ruby</category>
        
        <category>linux</category>
        
      </item>
    
  </channel>
</rss>
